# VRMNXファイル連携システム 仕様

## readFile関数
「read」フォルダにテキストファイルがあると`readFile`関数がファイルを読み込み、命令を実行します。  
ファイルはダブルクオーテーション無し、改行無し、タブ区切りの1行Shift-JISテキスト形式です。  
ファイル名は年月日時分秒「yyyymmddhhmmssfff.txt」です。  
読み込み対象は「＊.txt」で検出します。  
年月日時分秒の命名規則はFIFO（先入れ先出し）を遵守するためのルールです。  

## 構文サンプル
列車の速度を変える（列車ID10の速度を距離50で最高速度の50％に変える）
```
T	10	AutoSpeedCTRL	50	0.5
```

列車の進行方向を変える（0はダミー変数）
```
T	10	Turn	0
```

列車の電装を変える（0:OFF, 1:ON）
```
T	10	SetPower	0
```

ポイントを切り替える（ポイントID11の向きを1側にする）
```
P	11	SetBranch	1
```

複数ポイントを切り替える（ポイントID11と12の向きを1側、13の向きを0側）
```
P	11_12_-13	SetBranch	1
```

### (1) Object識別子
| 識別子 | オブジェクト | 名前 |
| ------ | ---- | ---- |
| T | VRMTrain  | 編成 |
| P | VRMPoint  | ポイント |
| A | VRMATS    | 自動センサー |
| B | VRMBell   | 音源 |
| C | VRMCamera | 地上カメラ |
| R | VRMCar    | 車輌 |
| X | VRMCrossing   | 踏切、ホームドア |
| E | VRMEmitter    | エミッター |
| L | VRMLayout     | レイアウト |
| M | VRMMotionPath | モーションパス |
| G | VRMSignal | 信号 |
| K | VRMSky    | スカイドーム、天候 |
| I | VRMSprite | スプライト |
| S | VRMSystem | システム |
| U | VRMTurntable  | ターンターブル |

### (2) ObjectID(int)
現行版は直接参照のみ対応しているため、無効なIDがある場合はエラーとなります。  
データ名での指定や、存在チェックを導入する予定です。

### (3) 命令関数名
VRMNXで定義されている各オブジェクトの命令文字列です。  
文字列が無効なものは命令が無視されます。

### (4) 命令引数
命令関数に必要な引数を記載します。  
引数が1つ以上ない場合は命令が無視されます。  
現行版は1つ以上を強制しています。（今後、命令セットに応じて要素数をチェック予定）

## sendSettingFile関数
「send」フォルダがある状態で`sendSettingFile`関数を実行するとレイアウトファイルから編成リストとポイントリストをID順でタブ区切りのShift_JISテキストファイルとして`send\yyyymmddhhmmssffffff.txt`へ出力します。  
主に「ネットワークコントローラー」等の設定情報として利用できます。  

出力に成功すると
```
sendフォルダにレイアウト情報ファイルを出力しました。
```
と表示します。  

出力例：
```
t	10	TRAIN_10	2028.6000053961689	6.0	1096.0780848595002	0.0
t	25	TRAIN_25	1297.874999999999	6.0	1400.0000223802317	0.0
t	54	TRAIN_54	1291.4000003714773	6.0	1163.484177169418	0.0
t	64	TRAIN_64	2028.6000027358723	6.0	1332.593930070314	0.0

p	675	B線上駅C渡り線XL	2108.00009006219	0.0	411.48450518271034	0
p	676	C線上駅B渡り線XL	2364.0000885889813	0.0	445.18758033766994	0
p	677	C線上駅B渡り線XL	2108.000088588982	0.0	445.18756914755403	0
p	678	B線上駅C渡り線XR	2364.0000900621894	0.0	411.4845163728262	0
```

### (1) 編成一覧
| 列 | 内容 | 詳細 |
| ---- | ---- | ---- |
| 1 | t(固定文字) | Object識別子 |
| 2 | ObjectID    | GetID() |
| 3 | ObjectNAME  | GetNAME() |
| 4 | X座標(横)   | GetPosition()[0] |
| 5 | Y座標(高さ) | GetPosition()[1] |
| 6 | Z座標(縦)   | GetPosition()[2] |
| 7 | 速度(電圧0.0～1.0) | GetVoltage() |

### (2) ポイント一覧
| 列 | 内容 | 詳細 |
| ---- | ---- | ---- |
| 1 | p(固定文字) | Object識別子 |
| 2 | ObjectID    | GetID() |
| 3 | ObjectNAME  | GetNAME() |
| 4 | X座標(横)   | GetPosition()[0] |
| 5 | Y座標(高さ) | GetPosition()[1] |
| 6 | Z座標(縦)   | GetPosition()[2] |
| 7 | 分岐状態(0,1) | GetBranch() |

## setPowerAll関数
「VRMNXファイル連携システム」と関係性の無い便利関数です。  
レイアウトにある全編成の電装系をONにします。  
主に起動時の初期設定として利用しますが、いつでも実行できます。
編成別に処理したい場合は```setPower```関数があります。
